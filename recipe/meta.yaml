{% set name = "conda-pypi" %}
{% set version = "0.3.0" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://pypi.org/packages/source/{{ name[0] }}/{{ name }}/conda_pypi-{{ version }}.tar.gz
  sha256: 79d2ba6686ce2c66cd242f8a9e4a2c11824296abad00be48702baf70389f7630

build:
  skip: true  # [py<39]
  # can't be noarch because we can't place EXTERNALLY-MANAGED in stdlib (first level is site-packages)
  number: 0
  script:
    - set -x  # [unix]
    - "@ECHO ON"  # [win]
    - {{ PYTHON }} -m pip install . --no-deps --no-build-isolation -vv
    - {{ PYTHON }} -c "from conda_pypi.python_paths import ensure_externally_managed; ensure_externally_managed()"

requirements:
  build:
    - python                                 # [build_platform != target_platform]
    - cross-python_{{ target_platform }}     # [build_platform != target_platform]
  host:
    - python
    - pip
    - hatchling >=1.12.2
    - hatch-vcs >=0.2.0
  run:
    - python
    - conda >=23.9.0
    - pip >=23.0.1
    - grayskull
    - packaging
    - unearth
    - pydantic
    - python-build
    - python-installer
    - requests
    - ruamel.yaml
    - typer
    - platformdirs
    - conda-index

test:
  imports:
    - conda_pypi
    - conda_pypi.main
  commands:
    - conda pypi --help
    - python -c "from conda_pypi.python_paths import get_env_stdlib; assert (get_env_stdlib() / 'EXTERNALLY-MANAGED').exists()"
    - pip install requests && exit 1 || exit 0

about:
  home: https://github.com/conda-incubator/conda-pypi
  license: MIT
  license_file: LICENSE
  summary: Better PyPI interoperability for the conda ecosystem
  dev_url: https://github.com/conda-incubator/conda-pypi
  doc_url: https://conda-incubator.github.io/conda-pypi

extra:
  recipe-maintainers:
    - jaimergp
    - jezdez
